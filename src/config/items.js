// ═══════════════════════════════════════════════════════════════
// config/items.js
// 商品配置 - 定义黑市所有商品及其效果
// ═══════════════════════════════════════════════════════════════

/**
 * 初始化默认商品配置
 * @param 商品注册表 - 商品定义注册表实例
 */
function 初始化商品配置(商品注册表) {
  // ═══════════════════════════════════════════════════════════════
  // 商品分类注册
  // ═══════════════════════════════════════════════════════════════

  商品注册表.注册商品分类('武装装备', {
    刷新周期: 1,
    随机刷新: false,
    描述: '用于提升喽啰战斗力的装备',
    排序权重: 100,
  });

  商品注册表.注册商品分类('奴隶商品', {
    刷新周期: 1,
    随机刷新: true,
    描述: '可购买的女性奴隶',
    排序权重: 90,
  });

  商品注册表.注册商品分类('特殊资源', {
    刷新周期: 1,
    随机刷新: false,
    描述: '稀有的特殊道具',
    排序权重: 80,
  });

  商品注册表.注册商品分类('消耗品', {
    刷新周期: 1,
    随机刷新: false,
    描述: '一次性使用的消耗品',
    排序权重: 70,
  });

  商品注册表.注册商品分类('稀有商品', {
    刷新周期: 4,
    随机刷新: true,
    描述: '每4周刷新的稀有商品',
    排序权重: 60,
  });

  // ═══════════════════════════════════════════════════════════════
  // 武装装备类商品
  // ═══════════════════════════════════════════════════════════════

  // ─── 低级装备 ───
  商品注册表.注册商品('破旧兵刃与皮甲残片', {
    分类: '武装装备',
    价格: 1,
    每周限购: Infinity,
    描述: '勉强能用的武器和护甲，聊胜于无',
    效果: {
      类型: '武装升级',
      目标等级: '低级武装',
      战斗力提升: 110, // 战斗力百分比
      每母乳武装数量: 10,
    },
    图标: '🗡️',
  });

  // ─── 中级装备 ───
  商品注册表.注册商品('标准铁剑与链甲套件', {
    分类: '武装装备',
    价格: 1,
    每周限购: Infinity,
    描述: '正规军队的标准装备',
    效果: {
      类型: '武装升级',
      目标等级: '中级武装',
      战斗力提升: 130,
      每母乳武装数量: 4,
    },
    图标: '⚔️',
  });

  // ─── 高级装备 ───
  商品注册表.注册商品('盗取的骑士全装', {
    分类: '武装装备',
    价格: 1,
    每周限购: Infinity,
    描述: '从战场上获取的骑士装备，非常珍贵',
    效果: {
      类型: '武装升级',
      目标等级: '高级武装',
      战斗力提升: 180,
      每母乳武装数量: 1,
    },
    图标: '🛡️',
  });

  // ─── 精英装备 ───
  商品注册表.注册商品('附魔战争装备', {
    分类: '武装装备',
    价格: 10,
    每周限购: 5,
    描述: '带有魔法增强的顶级装备',
    效果: {
      类型: '武装升级',
      目标等级: '精英武装',
      战斗力提升: 250,
      每母乳武装数量: 1,
    },
    稀有度: 3,
    图标: '✨',
  });

  // ═══════════════════════════════════════════════════════════════
  // 特殊资源类商品
  // ═══════════════════════════════════════════════════════════════

  // ─── 祝福水晶 ───
  商品注册表.注册商品('神殿祝福水晶', {
    分类: '特殊资源',
    价格: 25,
    每周限购: 3,
    描述: '神殿中流出的神圣水晶，可恢复雌性价值',
    效果: {
      类型: '祝福水晶',
      计算公式: '2000 / (淫乱度 + 20)',
      说明: '淫乱度越低，恢复效果越好',
    },
    图标: '💎',
  });

  // ─── 净化水晶 ───
  商品注册表.注册商品('神殿净化水晶', {
    分类: '特殊资源',
    价格: 15,
    每周限购: 3,
    描述: '可以净化淫乱的神圣之物',
    效果: {
      类型: '净化水晶',
      淫乱度减少: 10,
    },
    图标: '✝️',
  });

  // ─── 强效净化水晶 ───
  商品注册表.注册商品('大神殿净化水晶', {
    分类: '特殊资源',
    价格: 40,
    每周限购: 1,
    描述: '来自大神殿的强效净化水晶',
    效果: {
      类型: '净化水晶',
      淫乱度减少: 30,
    },
    稀有度: 2,
    图标: '🔮',
  });

  // ─── 魔力水晶 ───
  商品注册表.注册商品('黑暗魔力水晶', {
    分类: '特殊资源',
    价格: 50,
    每周限购: 2,
    描述: '蕴含黑暗魔力的水晶，可为领主补充魔力',
    效果: {
      类型: '魔力水晶',
      魔力恢复: 5,
    },
    稀有度: 2,
    图标: '🖤',
  });

  // ═══════════════════════════════════════════════════════════════
  // 消耗品类商品
  // ═══════════════════════════════════════════════════════════════

  // ─── 调教道具 ───
  商品注册表.注册商品('调教皮鞭', {
    分类: '消耗品',
    价格: 5,
    每周限购: 10,
    描述: '基础调教道具，提升单次调教效率',
    效果: {
      类型: '调教增幅',
      效率加成: 0.5,
      使用次数: 1,
    },
    图标: '🔗',
  });

  商品注册表.注册商品('精制调教工具套装', {
    分类: '消耗品',
    价格: 20,
    每周限购: 3,
    描述: '高级调教道具，大幅提升调教效率',
    效果: {
      类型: '调教增幅',
      效率加成: 1.0,
      使用次数: 3,
    },
    稀有度: 2,
    图标: '⛓️',
  });

  // ─── 催情药剂 ───
  商品注册表.注册商品('低级催情药剂', {
    分类: '消耗品',
    价格: 8,
    每周限购: 5,
    描述: '使用后增加目标母畜淫乱度',
    效果: {
      类型: '属性增加',
      目标属性: '淫乱度',
      增加量: 10,
    },
    图标: '🧪',
  });

  商品注册表.注册商品('高级催情药剂', {
    分类: '消耗品',
    价格: 25,
    每周限购: 2,
    描述: '强力催情药剂',
    效果: {
      类型: '属性增加',
      目标属性: '淫乱度',
      增加量: 25,
    },
    稀有度: 2,
    图标: '💜',
  });

  // ─── 顺从药剂 ───
  商品注册表.注册商品('顺从药剂', {
    分类: '消耗品',
    价格: 12,
    每周限购: 5,
    描述: '使用后增加目标母畜臣服度',
    效果: {
      类型: '属性增加',
      目标属性: '臣服度',
      增加量: 10,
    },
    图标: '💊',
  });

  // ─── 士气鼓舞物 ───
  商品注册表.注册商品('烈酒桶', {
    分类: '消耗品',
    价格: 10,
    每周限购: 5,
    描述: '给喽啰们喝的烈酒，提升士气',
    效果: {
      类型: '士气增加',
      增加量: 10,
    },
    图标: '🍺',
  });

  商品注册表.注册商品('战争号角', {
    分类: '消耗品',
    价格: 30,
    每周限购: 2,
    描述: '激励军队的号角，大幅提升士气',
    效果: {
      类型: '士气增加',
      增加量: 25,
    },
    稀有度: 2,
    图标: '📯',
  });

  // ═══════════════════════════════════════════════════════════════
  // 奴隶商品刷新规则
  // ═══════════════════════════════════════════════════════════════

  商品注册表.注册刷新规则('奴隶商品', (周次, 上下文) => {
    const 商品列表 = [];

    // ─── 低质奴隶（常驻）───
    商品列表.push({
      名称: '债务抵押的农家女',
      分类: '奴隶商品',
      价格: 5,
      每周限购: 3,
      描述: '因家庭债务被卖的普通农家女子',
      效果: {
        类型: '获得母畜',
        总雌性价值范围: [80, 120],
        初始臣服度: 10,
        原身份: '农家女',
        种族: '人类',
      },
      图标: '👩‍🌾',
    });

    商品列表.push({
      名称: '落魄商人之女',
      分类: '奴隶商品',
      价格: 8,
      每周限购: 2,
      描述: '商人破产后沦落的女儿',
      效果: {
        类型: '获得母畜',
        总雌性价值范围: [100, 150],
        初始臣服度: 5,
        原身份: '商人之女',
        种族: '人类',
      },
      图标: '👩‍💼',
    });

    // ─── 中质奴隶（常驻）───
    商品列表.push({
      名称: '破落贵族千金',
      分类: '奴隶商品',
      价格: 15,
      每周限购: 2,
      描述: '家道中落的贵族小姐',
      效果: {
        类型: '获得母畜',
        总雌性价值范围: [150, 200],
        初始臣服度: 0,
        原身份: '贵族',
        种族: '人类',
      },
      稀有度: 2,
      图标: '👸',
    });

    商品列表.push({
      名称: '流浪的女冒险者',
      分类: '奴隶商品',
      价格: 18,
      每周限购: 1,
      描述: '被俘获的低阶女冒险者',
      效果: {
        类型: '获得母畜',
        总雌性价值范围: [180, 250],
        初始臣服度: 0,
        原身份: '低阶冒险者',
        种族: '人类',
      },
      稀有度: 2,
      图标: '🗡️',
    });

    // ─── 每2周随机刷新一个特殊奴隶 ───
    if (周次 % 2 === 0) {
      const 特殊奴隶池 = [
        {
          名称: '精灵族少女',
          价格: 35,
          描述: '罕见的精灵族女性',
          效果: {
            类型: '获得母畜',
            总雌性价值范围: [250, 350],
            初始臣服度: 0,
            原身份: '普通人',
            种族: '精灵',
            特殊标签: ['精灵血脉'],
          },
          稀有度: 3,
          图标: '🧝‍♀️',
        },
        {
          名称: '半兽人女武者',
          价格: 25,
          描述: '拥有野性力量的半兽人',
          效果: {
            类型: '获得母畜',
            总雌性价值范围: [150, 200],
            初始臣服度: 0,
            原身份: '战士',
            种族: '兽人',
            特殊标签: ['野性'],
          },
          稀有度: 2,
          图标: '🐺',
        },
        {
          名称: '被逐出的女见习法师',
          价格: 40,
          描述: '因违规被驱逐的法师学徒',
          效果: {
            类型: '获得母畜',
            总雌性价值范围: [280, 350],
            初始臣服度: 5,
            原身份: '见习法师',
            种族: '人类',
            特殊标签: ['法师血脉'],
          },
          稀有度: 3,
          图标: '🧙‍♀️',
        },
      ];

      // 随机选择一个
      const 随机索引 = Math.floor(Math.random() * 特殊奴隶池.length);
      const 选中商品 = 特殊奴隶池[随机索引];

      商品列表.push({
        ...选中商品,
        分类: '奴隶商品',
        每周限购: 1,
      });
    }

    // ─── 每4周有概率刷新高价值奴隶 ───
    if (周次 % 4 === 0 && Math.random() < 0.5) {
      const 稀有奴隶池 = [
        {
          名称: '流亡小国的落难公主',
          价格: 80,
          描述: '亡国后流落黑市的公主',
          效果: {
            类型: '获得母畜',
            总雌性价值: 400,
            初始臣服度: 0,
            原身份: '公主',
            种族: '人类',
            特殊标签: ['王族血脉', '高贵'],
          },
          稀有度: 4,
          图标: '👑',
        },
        {
          名称: '堕落的圣殿女骑士',
          价格: 70,
          描述: '被判为异端的女骑士',
          效果: {
            类型: '获得母畜',
            总雌性价值: 380,
            初始臣服度: 0,
            原身份: '女骑士',
            种族: '人类',
            特殊标签: ['骑士训练', '神圣'],
          },
          稀有度: 4,
          图标: '⚔️',
        },
        {
          名称: '纯血精灵女祭司',
          价格: 100,
          描述: '极其罕见的精灵族祭司',
          效果: {
            类型: '获得母畜',
            总雌性价值: 500,
            初始臣服度: 0,
            原身份: '圣女',
            种族: '精灵',
            特殊标签: ['精灵血脉', '神圣', '纯血'],
          },
          稀有度: 5,
          图标: '🌟',
        },
      ];

      const 随机索引 = Math.floor(Math.random() * 稀有奴隶池.length);
      const 选中商品 = 稀有奴隶池[随机索引];

      商品列表.push({
        ...选中商品,
        分类: '奴隶商品',
        每周限购: 1,
      });
    }

    return 商品列表;
  });

  // ═══════════════════════════════════════════════════════════════
  // 稀有商品刷新规则
  // ═══════════════════════════════════════════════════════════════

  商品注册表.注册刷新规则('稀有商品', (周次, 上下文) => {
    const 商品列表 = [];

    // 每4周刷新的稀有商品池
    const 稀有商品池 = [
      {
        名称: '古代繁殖秘药',
        价格: 100,
        描述: '传说中能够大幅提升生育价值的秘药',
        效果: {
          类型: '价值提升',
          总雌性价值提升: 100,
        },
        稀有度: 4,
        图标: '📜',
      },
      {
        名称: '禁忌的献祭仪式书',
        价格: 80,
        描述: '记载着能够提升献祭效率的知识',
        效果: {
          类型: '献祭增幅',
          魔力获得加成: 0.5,
          持续: '永久',
        },
        稀有度: 4,
        图标: '📕',
      },
      {
        名称: '战神的祝福符文',
        价格: 60,
        描述: '永久提升军队基础战力',
        效果: {
          类型: '战力永久提升',
          战力提升: 10,
        },
        稀有度: 3,
        图标: '🔱',
      },
      {
        名称: '龙血催情剂',
        价格: 50,
        描述: '将目标母畜淫乱度直接提升至80',
        效果: {
          类型: '属性设置',
          目标属性: '淫乱度',
          设置值: 80,
        },
        稀有度: 3,
        图标: '🐉',
      },
      {
        名称: '精神控制权杖',
        价格: 70,
        描述: '将目标母畜臣服度直接提升至90',
        效果: {
          类型: '属性设置',
          目标属性: '臣服度',
          设置值: 90,
        },
        稀有度: 4,
        图标: '🪄',
      },
    ];

    // 随机选择2-3个稀有商品
    const 刷新数量 = 2 + Math.floor(Math.random() * 2);
    const 已选索引 = new Set();

    while (商品列表.length < 刷新数量 && 已选索引.size < 稀有商品池.length) {
      const 随机索引 = Math.floor(Math.random() * 稀有商品池.length);
      if (!已选索引.has(随机索引)) {
        已选索引.add(随机索引);
        商品列表.push({
          ...稀有商品池[随机索引],
          分类: '稀有商品',
          每周限购: 1,
        });
      }
    }

    return 商品列表;
  });
}

// ═══════════════════════════════════════════════════════════════
// 商品效果类型说明
// ═══════════════════════════════════════════════════════════════

const 商品效果类型说明 = {
  武装升级: {
    描述: '将未武装的喽啰升级为指定武装等级',
    参数: ['目标等级', '战斗力提升', '每母乳武装数量'],
  },
  获得母畜: {
    描述: '获得一名新的母畜',
    参数: ['总雌性价值范围', '初始臣服度', '原身份', '种族', '特殊标签'],
  },
  祝福水晶: {
    描述: '恢复母畜的剩余雌性价值',
    参数: ['计算公式'],
  },
  净化水晶: {
    描述: '降低母畜的淫乱度',
    参数: ['淫乱度减少'],
  },
  魔力水晶: {
    描述: '恢复领主的魔力',
    参数: ['魔力恢复'],
  },
  调教增幅: {
    描述: '提升调教任务效率',
    参数: ['效率加成', '使用次数'],
  },
  属性增加: {
    描述: '增加目标母畜的指定属性',
    参数: ['目标属性', '增加量'],
  },
  属性设置: {
    描述: '将目标母畜的指定属性设置为特定值',
    参数: ['目标属性', '设置值'],
  },
  士气增加: {
    描述: '增加军队士气',
    参数: ['增加量'],
  },
  价值提升: {
    描述: '提升母畜的总雌性价值',
    参数: ['总雌性价值提升'],
  },
  战力永久提升: {
    描述: '永久提升军队基础战力',
    参数: ['战力提升'],
  },
};

// ═══════════════════════════════════════════════════════════════
// 导出
// ═══════════════════════════════════════════════════════════════

export { 初始化商品配置, 商品效果类型说明 };
export default 初始化商品配置;
