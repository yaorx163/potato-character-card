// ═══════════════════════════════════════════════════════════════
// config/attributes.js
// 属性配置 - 定义所有属性类型及其阶段
// ═══════════════════════════════════════════════════════════════

/**
 * 初始化默认属性定义
 * @param 属性注册表 - 属性定义注册表实例
 */
function 初始化属性配置(属性注册表) {
  // ═══════════════════════════════════════════════════════════════
  // 母畜属性
  // ═══════════════════════════════════════════════════════════════

  // ─── 臣服度 ───
  属性注册表.注册属性类型('臣服度', {
    默认值: 0,
    最小值: 0,
    最大值: 100,
    描述: '母畜对部落的服从程度，影响可执行的任务类型',
    单位: '',
    阶段定义: [
      {
        名称: '抗拒期',
        等级: 1,
        下限: 0,
        上限: 24,
        描述: '充满敌意，有逃跑风险，需要监控',
        解锁任务: [],
        行为特征: ['可能尝试逃跑', '拒绝合作', '需要强制'],
      },
      {
        名称: '动摇期',
        等级: 2,
        下限: 25,
        上限: 49,
        描述: '意志开始松动，逐渐接受现状',
        解锁任务: ['生育喽啰'],
        行为特征: ['被动服从', '偶尔反抗', '可繁殖'],
      },
      {
        名称: '顺从期',
        等级: 3,
        下限: 50,
        上限: 74,
        描述: '接受现状，开始主动配合',
        解锁任务: ['生育冠军'],
        行为特征: ['主动配合', '不再反抗', '可培养'],
      },
      {
        名称: '归心期',
        等级: 4,
        下限: 75,
        上限: 89,
        描述: '认同部落，积极参与部落事务',
        解锁任务: ['劝慰', '提振士气'],
        行为特征: ['积极参与', '关心部落', '可信任'],
      },
      {
        名称: '忠诚期',
        等级: 5,
        下限: 90,
        上限: 100,
        描述: '彻底归化，愿意为部落付出一切',
        解锁任务: ['潜入侦察', '潜入劝诱'],
        行为特征: ['绝对忠诚', '舍身奉献', '可委以重任'],
      },
    ],
  });

  // ─── 淫乱度 ───
  属性注册表.注册属性类型('淫乱度', {
    默认值: 0,
    最小值: 0,
    最大值: 100,
    描述: '母畜的淫乱程度，影响产出能力和特殊功能',
    单位: '',
    阶段定义: [
      {
        名称: '常态期',
        等级: 1,
        下限: 0,
        上限: 24,
        描述: '保持正常状态，具有正常抵抗力',
        解锁能力: [],
        特征: ['正常状态', '可抵抗诱惑'],
      },
      {
        名称: '泌乳期',
        等级: 2,
        下限: 25,
        上限: 49,
        描述: '身体开始变化，可以诱导产出母乳',
        解锁能力: ['泌乳'],
        特征: ['可产母乳', '身体敏感度提升'],
      },
      {
        名称: '渴求期',
        等级: 3,
        下限: 50,
        上限: 74,
        描述: '持续处于不满足状态，渴求刺激',
        解锁能力: ['增强泌乳'],
        特征: ['主动索求', '难以自控', '产量提升'],
      },
      {
        名称: '淫堕期',
        等级: 4,
        下限: 75,
        上限: 99,
        描述: '本能逐渐支配理智，沉溺于肉欲',
        解锁能力: ['极限泌乳'],
        特征: ['本能驱动', '理智削弱', '高产量'],
      },
      {
        名称: '完全淫堕',
        等级: 5,
        下限: 100,
        上限: 100,
        描述: '彻底被本能支配，可用于献祭',
        解锁能力: ['献祭转化'],
        特征: ['丧失理智', '纯粹肉欲', '可献祭'],
      },
    ],
  });

  // ─── 雌性价值 ───
  属性注册表.注册属性类型('剩余雌性价值', {
    默认值: 100,
    最小值: 0,
    最大值: Infinity, // 上限由总雌性价值决定
    描述: '母畜剩余的生育价值，消耗后无法恢复（除非使用特殊道具）',
    单位: '点',
  });

  属性注册表.注册属性类型('总雌性价值', {
    默认值: 100,
    最小值: 10,
    最大值: 1000,
    描述: '母畜的总生育价值，决定其生育潜力和子代品质',
    单位: '点',
  });

  // ═══════════════════════════════════════════════════════════════
  // 冠军属性
  // ═══════════════════════════════════════════════════════════════

  // ─── 力量 ───
  属性注册表.注册属性类型('力量', {
    默认值: 10,
    最小值: 1,
    最大值: 100,
    描述: '物理力量，影响可统帅喽啰数量和战斗力',
    单位: '',
    影响: ['可统帅喽啰数 = 力量值', '部曲战力加成', '惩戒任务效率'],
  });

  // ─── 敏捷 ───
  属性注册表.注册属性类型('敏捷', {
    默认值: 10,
    最小值: 1,
    最大值: 100,
    描述: '行动敏捷度，影响侦察效率和规避能力',
    单位: '',
    影响: ['直接侦察效率', '遭遇战规避概率', '锁定目标概率'],
  });

  // ─── 智力 ───
  属性注册表.注册属性类型('智力', {
    默认值: 10,
    最小值: 1,
    最大值: 100,
    描述: '智慧程度，影响调教效率和策略能力',
    单位: '',
    影响: ['调教任务效率', '战术判断'],
  });

  // ═══════════════════════════════════════════════════════════════
  // 军队属性
  // ═══════════════════════════════════════════════════════════════

  // ─── 士气 ───
  属性注册表.注册属性类型('士气', {
    默认值: 50,
    最小值: 0,
    最大值: 100,
    描述: '军队士气，影响战斗力系数',
    单位: '',
    衰减配置: {
      周期: '周',
      衰减量: 5,
      描述: '每周自然衰减5点',
    },
    阶段定义: [
      { 名称: '崩溃', 等级: 1, 下限: 0, 上限: 19, 系数: 0.5 },
      { 名称: '低迷', 等级: 2, 下限: 20, 上限: 39, 系数: 0.75 },
      { 名称: '正常', 等级: 3, 下限: 40, 上限: 59, 系数: 1.0 },
      { 名称: '高涨', 等级: 4, 下限: 60, 上限: 79, 系数: 1.25 },
      { 名称: '狂热', 等级: 5, 下限: 80, 上限: 100, 系数: 1.5 },
    ],
  });

  // ═══════════════════════════════════════════════════════════════
  // 领主属性
  // ═══════════════════════════════════════════════════════════════

  // ─── 魔力 ───
  属性注册表.注册属性类型('魔力', {
    默认值: 0,
    最小值: 0,
    最大值: 100,
    描述: '领主的魔力值，用于施放法术',
    单位: '点',
    获取方式: ['献祭完全淫堕的母畜', '黑丝购买'],
  });

  属性注册表.注册属性类型('最大魔力', {
    默认值: 100,
    最小值: 10,
    最大值: 999,
    描述: '领主的魔力上限',
    单位: '点',
  });

  // ═══════════════════════════════════════════════════════════════
  // 派生属性计算器
  // ═══════════════════════════════════════════════════════════════

  // 泌乳产量计算
  属性注册表.注册属性计算器('泌乳产量', 上下文 => {
    const 淫乱度 = 上下文.实体?.获取属性('淫乱度') ?? 0;
    if (淫乱度 < 25) return 0;
    return Math.floor((淫乱度 + 45) / 20);
  });

  // 可统帅喽啰数计算
  属性注册表.注册属性计算器('可统帅喽啰数', 上下文 => {
    const 力量 = 上下文.实体?.获取属性('力量') ?? 0;
    return 力量;
  });

  // 调教效率计算
  属性注册表.注册属性计算器('调教效率', 上下文 => {
    const 实体 = 上下文.实体;
    if (!实体) return 0;
    if (实体.类型 !== '') return 0;
    const 智力 = 上下文.实体?.获取属性('智力') ?? 0;
    return 5 * (智力 / 25) + 5;
  });

  // 侦察效率计算
  属性注册表.注册属性计算器('侦察效率', 上下文 => {
    const 敏捷 = 上下文.实体?.获取属性('敏捷') ?? 0;
    return 1 * (敏捷 / 25);
  });

  // 潜入侦察效率
  属性注册表.注册属性计算器('潜入侦察效率', 上下文 => {
    const 淫乱度 = 上下文.实体?.获取属性('淫乱度') ?? 0;
    const 臣服度 = 上下文.实体?.获取属性('臣服度') ?? 0;
    return 1 * (敏捷 / 25);
  });
}

// ═══════════════════════════════════════════════════════════════
// 身份雌性价值配置
// ═══════════════════════════════════════════════════════════════

const 身份雌性价值配置 = {
  普通人: { 最小: 80, 最大: 120 },
};

// ═══════════════════════════════════════════════════════════════
// 冠军生育效率系数配置
// ═══════════════════════════════════════════════════════════════

const 冠军生育效率系数配置 = {
  // 默认
  普通人: { 力量: 1.0, 敏捷: 1.0, 智力: 1.0 },
};

// ═══════════════════════════════════════════════════════════════
// 种族价值修正配置
// ═══════════════════════════════════════════════════════════════

const 种族价值修正配置 = {
  人类: { 力量: 1.0, 敏捷: 1.0, 智力: 1.1 },
};

// ═══════════════════════════════════════════════════════════════
// 导出
// ═══════════════════════════════════════════════════════════════

export { 初始化属性配置, 身份雌性价值配置, 冠军效率系数配置, 种族价值修正配置 };

export default 初始化属性配置;
