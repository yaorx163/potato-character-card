// ═══════════════════════════════════════════════════════════════
// config/raid-targets.js
// 袭击目标配置 - 定义目标类型、战力范围、高价值目标生成规则
// ═══════════════════════════════════════════════════════════════

/**
 * 袭击目标类型配置
 * 定义每种目标的基础属性范围和特征
 */
const 袭击目标类型配置 = {
  村庄: {
    战力范围: { 最小: 20, 最大: 80 },
    高价值目标数量: { 最小: 1, 最大: 3 },
    描述模板: ['偏远的小村庄', '宁静的农业村落', '山脚下的村庄', '河边的渔村'],
    位置类型: ['平原', '山区', '河谷', '森林边缘'],
    高价值目标身份池: ['农家女', '村长之女', '工匠之女'],
    稀有身份概率: 0.1,
    稀有身份池: ['商人之女', '低阶冒险者'],
  },

  商队: {
    战力范围: { 最小: 40, 最大: 120 },
    高价值目标数量: { 最小: 1, 最大: 4 },
    描述模板: ['途经的贸易商队', '满载货物的大商队', '精灵商人的队伍', '跨国商队'],
    位置类型: ['商道', '山路', '平原', '边境'],
    高价值目标身份池: ['商人之女', '佣人', '普通人'],
    稀有身份概率: 0.15,
    稀有身份池: ['低阶冒险者', '见习法师', '贵族'],
  },

  城镇: {
    战力范围: { 最小: 100, 最大: 250 },
    高价值目标数量: { 最小: 2, 最大: 6 },
    描述模板: ['繁华的边境城镇', '矿业小城', '交通要道上的城镇', '古老的城镇'],
    位置类型: ['交叉路口', '矿区', '边境', '河岸'],
    高价值目标身份池: ['商人之女', '城主之女', '工匠之女', '低阶冒险者'],
    稀有身份概率: 0.2,
    稀有身份池: ['女骑士', '见习法师', '贵族'],
  },

  城市: {
    战力范围: { 最小: 300, 最大: 600 },
    高价值目标数量: { 最小: 3, 最大: 8 },
    描述模板: ['王国边陲的城市', '商业都市', '学院城市', '军事重镇'],
    位置类型: ['王国边境', '内陆', '沿海', '要塞区'],
    高价值目标身份池: ['贵族', '城主之女', '女骑士', '低阶冒险者', '见习法师'],
    稀有身份概率: 0.25,
    稀有身份池: ['高阶法师', '女将军', '大贵族'],
  },

  要塞: {
    战力范围: { 最小: 400, 最大: 800 },
    高价值目标数量: { 最小: 2, 最大: 5 },
    描述模板: ['边境要塞', '山间堡垒', '古老的防御工事', '骑士团驻地'],
    位置类型: ['山口', '边境', '战略要地', '峡谷'],
    高价值目标身份池: ['女骑士', '女侍卫', '女将军'],
    稀有身份概率: 0.3,
    稀有身份池: ['圣女', '公主', '高阶法师'],
  },

  修道院: {
    战力范围: { 最小: 60, 最大: 180 },
    高价值目标数量: { 最小: 2, 最大: 6 },
    描述模板: ['隐秘的修道院', '圣光教团分院', '山中修女院', '古老的祈祷所'],
    位置类型: ['山区', '森林深处', '湖边', '悬崖'],
    高价值目标身份池: ['普通人', '见习法师'],
    稀有身份概率: 0.35,
    稀有身份池: ['圣女', '高阶法师'],
    特殊标签: ['神圣'],
  },

  冒险者营地: {
    战力范围: { 最小: 80, 最大: 200 },
    高价值目标数量: { 最小: 1, 最大: 4 },
    描述模板: ['冒险者临时营地', '探险队宿营地', '迷宫入口的营地', '猎人集合点'],
    位置类型: ['迷宫附近', '荒野', '遗迹旁', '森林'],
    高价值目标身份池: ['低阶冒险者', '见习法师'],
    稀有身份概率: 0.25,
    稀有身份池: ['女骑士', '高阶法师', '盗贼'],
  },

  贵族庄园: {
    战力范围: { 最小: 150, 最大: 350 },
    高价值目标数量: { 最小: 2, 最大: 5 },
    描述模板: ['乡间贵族庄园', '伯爵领地', '男爵的宅邸', '退休骑士的庄园'],
    位置类型: ['田园', '丘陵', '葡萄园区', '湖畔'],
    高价值目标身份池: ['贵族', '大贵族', '佣人', '女侍卫'],
    稀有身份概率: 0.3,
    稀有身份池: ['公主', '女骑士'],
  },
};

/**
 * 高价值目标生成权重配置
 * 根据目标身份决定种族分布
 */
const 种族权重配置 = {
  默认: {
    人类: 70,
    精灵: 10,
    半精灵: 10,
    兽人: 5,
    矮人: 5,
  },
  精灵商队: {
    人类: 20,
    精灵: 50,
    半精灵: 25,
    兽人: 0,
    矮人: 5,
  },
  修道院: {
    人类: 80,
    精灵: 15,
    半精灵: 5,
    兽人: 0,
    矮人: 0,
  },
};

/**
 * 高价值目标年龄配置
 */
const 年龄范围配置 = {
  默认: { 最小: 16, 最大: 35 },
  贵族: { 最小: 16, 最大: 28 },
  冒险者: { 最小: 18, 最大: 32 },
  修女: { 最小: 18, 最大: 40 },
};

/**
 * 目标难度系数配置
 * 用于动态调整战力
 */
const 难度系数配置 = {
  简单: 0.7,
  普通: 1.0,
  困难: 1.3,
  噩梦: 1.6,
};

/**
 * 护卫战力贡献配置
 * 每个护卫贡献的战力
 */
const 护卫战力配置 = {
  民兵: 2,
  卫兵: 5,
  士兵: 8,
  骑士: 15,
  精英骑士: 25,
  法师: 20,
};

/**
 * 初始化袭击目标相关公式
 * @param 公式引擎 - 公式引擎实例
 */
function 初始化袭击目标公式(公式引擎) {
  // ─── 常量设置 ───
  公式引擎.批量设置常量({
    // 战力浮动范围
    目标战力浮动比例: 0.15,

    // 高价值目标价值浮动
    高价值目标价值浮动: 0.1,

    // 稀有度阈值
    稀有身份触发阈值: 0.1,
    传奇身份触发阈值: 0.02,

    // 护卫数量系数
    护卫数量战力系数: 0.3,
  });

  // ─── 目标战力计算 ───
  公式引擎.注册公式(
    '目标战力计算',
    ({ 基础战力, 难度系数, 随机浮动 }, 常量) => {
      const 浮动比例 = 常量.目标战力浮动比例 ?? 0.15;
      const 浮动值 = 基础战力 * 浮动比例 * 随机浮动;
      return Math.floor((基础战力 + 浮动值) * 难度系数);
    },
    {
      描述: '计算袭击目标的实际战力',
      参数说明: {
        基础战力: '目标类型的基础战力',
        难度系数: '游戏难度系数',
        随机浮动: '-1到1的随机浮动值',
      },
      分类: '袭击',
    },
  );

  // ─── 高价值目标数量计算 ───
  公式引擎.注册公式(
    '高价值目标数量计算',
    ({ 最小数量, 最大数量, 运气系数 }) => {
      const 基础数量 = Math.floor(Math.random() * (最大数量 - 最小数量 + 1)) + 最小数量;
      return Math.max(最小数量, Math.floor(基础数量 * 运气系数));
    },
    {
      描述: '计算目标中高价值目标的数量',
      参数说明: {
        最小数量: '最小数量',
        最大数量: '最大数量',
        运气系数: '运气系数，默认1.0',
      },
      分类: '袭击',
    },
  );

  // ─── 护卫数量估算 ───
  公式引擎.注册公式(
    '护卫数量估算',
    ({ 战力, 护卫类型战力 }, 常量) => {
      const 系数 = 常量.护卫数量战力系数 ?? 0.3;
      return Math.floor((战力 * 系数) / 护卫类型战力);
    },
    {
      描述: '根据战力估算护卫数量',
      参数说明: {
        战力: '目标总战力',
        护卫类型战力: '护卫类型的单位战力',
      },
      分类: '袭击',
    },
  );
}

// ═══════════════════════════════════════════════════════════════
// 导出
// ═══════════════════════════════════════════════════════════════

export { 袭击目标类型配置, 种族权重配置, 年龄范围配置, 难度系数配置, 护卫战力配置, 初始化袭击目标公式 };

export default 袭击目标类型配置;
