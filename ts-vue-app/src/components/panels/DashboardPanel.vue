<!-- components/panels/DashboardPanel.vue -->
<script setup lang="ts">
import { computed } from 'vue';
import { useGameStore } from '../../stores/gameStore';
import ResourceBar from '../../components/common/ResourceBar.vue';

const store = useGameStore();

const ç»Ÿè®¡æ•°æ® = computed(() => ({
  å† å†›æ•°é‡: store.æ‰€æœ‰å† å†›.length,
  æ¯ç•œæ•°é‡: store.æ‰€æœ‰æ¯ç•œ.length,
  åœ°ç‚¹æ•°é‡: store.æ‰€æœ‰åœ°ç‚¹.length,
  å–½å•°æ€»æ•°: store.å–½å•°æ€»æ•°,
  å¾…æ‰§è¡Œä»»åŠ¡: store.å·²å‘å¸ƒä»»åŠ¡åˆ—è¡¨.length,
  å¯ç”¨é­”åŠ›: store.é­”åŠ›ä¿¡æ¯.å½“å‰,
}));
</script>

<template>
  <div class="dashboard-panel">
    <div class="panel panel--elevated">
      <div class="panel__header">
        <h2 class="panel__title">é¢†åœ°æ€»è§ˆ</h2>
        <span class="turn-indicator">ç¬¬ {{ store.å½“å‰å›åˆ }} å›åˆ</span>
      </div>

      <div class="dashboard-grid">
        <!-- èµ„æºå¡ç‰‡ -->
        <div class="resource-card">
          <h3 class="resource-card__title">ğŸ”® é­”åŠ›å‚¨å¤‡</h3>
          <ResourceBar
            label="é­”åŠ›"
            :current="store.é­”åŠ›ä¿¡æ¯.å½“å‰"
            :max="store.é­”åŠ›ä¿¡æ¯.æœ€å¤§"
            color="accent"
          />
          <p class="resource-card__hint">æ¶ˆè€—é­”åŠ›æ–½æ”¾æ³•æœ¯</p>
        </div>

        <div class="resource-card">
          <h3 class="resource-card__title">âš”ï¸ å†›é˜Ÿå£«æ°”</h3>
          <ResourceBar
            label="å£«æ°”"
            :current="store.èµ„æºçŠ¶æ€.å£«æ°”"
            :max="store.èµ„æºçŠ¶æ€.æœ€å¤§å£«æ°”"
            color="success"
          />
          <p class="resource-card__hint">å£«æ°”å½±å“æˆ˜æ–—è¡¨ç°</p>
        </div>

        <div class="resource-card">
          <h3 class="resource-card__title">ğŸ¼ å‚¬æ·«æ¯ä¹³</h3>
          <div class="milk-display">
            <span class="milk-value">{{ store.èµ„æºçŠ¶æ€.å‚¬æ·«æ¯ä¹³ }}</span>
            <span class="milk-unit">å•ä½</span>
          </div>
          <p class="resource-card__hint">ç”¨äºé»‘å¸‚äº¤æ˜“</p>
        </div>
      </div>

      <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
      <div class="stats-overview">
        <div class="stat-block">
          <span class="stat-block__icon">ğŸ‘º</span>
          <span class="stat-block__value">{{ ç»Ÿè®¡æ•°æ®.å† å†›æ•°é‡ }}</span>
          <span class="stat-block__label">å† å†›</span>
        </div>
        <div class="stat-block">
          <span class="stat-block__icon">ğŸ‘©</span>
          <span class="stat-block__value">{{ ç»Ÿè®¡æ•°æ®.æ¯ç•œæ•°é‡ }}</span>
          <span class="stat-block__label">æ¯ç•œ</span>
        </div>
        <div class="stat-block">
          <span class="stat-block__icon">ğŸ‘¥</span>
          <span class="stat-block__value">{{ ç»Ÿè®¡æ•°æ®.å–½å•°æ€»æ•° }}</span>
          <span class="stat-block__label">å–½å•°</span>
        </div>
        <div class="stat-block">
          <span class="stat-block__icon">ğŸ˜ï¸</span>
          <span class="stat-block__value">{{ ç»Ÿè®¡æ•°æ®.åœ°ç‚¹æ•°é‡ }}</span>
          <span class="stat-block__label">å¯è¢­å‡»åœ°ç‚¹</span>
        </div>
        <div class="stat-block" :class="{ 'stat-block--highlight': ç»Ÿè®¡æ•°æ®.å¾…æ‰§è¡Œä»»åŠ¡ > 0 }">
          <span class="stat-block__icon">ğŸ“‹</span>
          <span class="stat-block__value">{{ ç»Ÿè®¡æ•°æ®.å¾…æ‰§è¡Œä»»åŠ¡ }}</span>
          <span class="stat-block__label">å¾…æ‰§è¡Œä»»åŠ¡</span>
        </div>
      </div>
    </div>

    <!-- å¿«é€Ÿæ“ä½œ -->
    <div class="panel panel--elevated mt-lg">
      <div class="panel__header">
        <h2 class="panel__title">å¿«é€Ÿæ“ä½œ</h2>
      </div>
      <div class="quick-actions">
        <button class="quick-action" @click="store.åˆ‡æ¢é¢æ¿('entities')">
          <span class="quick-action__icon">ğŸ‘¥</span>
          <span class="quick-action__label">ç®¡ç†å®ä½“</span>
        </button>
        <button class="quick-action" @click="store.åˆ‡æ¢é¢æ¿('tasks')">
          <span class="quick-action__icon">ğŸ“‹</span>
          <span class="quick-action__label">æ´¾é£ä»»åŠ¡</span>
        </button>
        <button class="quick-action" @click="store.åˆ‡æ¢é¢æ¿('combat')">
          <span class="quick-action__icon">âš”ï¸</span>
          <span class="quick-action__label">å‘èµ·è¢­å‡»</span>
        </button>
        <button class="quick-action" @click="store.åˆ‡æ¢é¢æ¿('spells')">
          <span class="quick-action__icon">âœ¨</span>
          <span class="quick-action__label">æ–½æ”¾æ³•æœ¯</span>
        </button>
        <button class="quick-action" @click="store.åˆ‡æ¢é¢æ¿('market')">
          <span class="quick-action__icon">ğŸª</span>
          <span class="quick-action__label">é»‘å¸‚äº¤æ˜“</span>
        </button>
      </div>
    </div>

    <!-- å½“å‰ä»»åŠ¡åˆ—è¡¨ -->
    <div v-if="store.å·²å‘å¸ƒä»»åŠ¡åˆ—è¡¨.length > 0" class="panel panel--elevated mt-lg">
      <div class="panel__header">
        <h2 class="panel__title">å¾…æ‰§è¡Œä»»åŠ¡</h2>
        <span class="badge badge--accent">{{ store.å·²å‘å¸ƒä»»åŠ¡åˆ—è¡¨.length }}</span>
      </div>
      <div class="task-list">
        <div
          v-for="task in store.å·²å‘å¸ƒä»»åŠ¡åˆ—è¡¨"
          :key="task.ä»»åŠ¡ID"
          class="task-item"
        >
          <span class="task-name">{{ task.ä»»åŠ¡å }}</span>
          <span class="task-executor">æ‰§è¡Œäºº: {{ task.æ‰§è¡ŒäººID.slice(0, 10) }}...</span>
          <button
            class="btn btn--ghost btn--sm"
            @click="store.å–æ¶ˆä»»åŠ¡(task.ä»»åŠ¡ID)"
          >
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped lang="scss">
@use '@/styles/variables' as *;

.dashboard-panel {
  max-width: 1200px;
  margin: 0 auto;
}

.turn-indicator {
  padding: $spacing-sm $spacing-lg;
  background: $color-accent;
  border-radius: $radius-sm;
  font-size: $font-size-sm;
  font-weight: 600;
  color: $bg-darkest;
}

.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: $spacing-lg;
  margin-bottom: $spacing-xl;
}

.resource-card {
  padding: $spacing-lg;
  background: $bg-light;
  border: 1px solid $border-medium;
  border-radius: $radius-md;

  &__title {
    font-size: $font-size-base;
    font-weight: 600;
    color: $text-highlight;
    margin: 0 0 $spacing-md;
  }

  &__hint {
    margin: $spacing-sm 0 0;
    font-size: $font-size-xs;
    color: $text-muted;
  }
}

.milk-display {
  display: flex;
  align-items: baseline;
  gap: $spacing-sm;

  .milk-value {
    font-size: $font-size-3xl;
    font-weight: 700;
    color: $color-primary-light;
  }

  .milk-unit {
    font-size: $font-size-sm;
    color: $text-muted;
  }
}

.stats-overview {
  display: flex;
  justify-content: space-between;
  padding: $spacing-lg;
  background: $bg-medium;
  border-radius: $radius-md;
}

.stat-block {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: $spacing-xs;
  padding: $spacing-md $spacing-lg;
  border-radius: $radius-md;
  transition: all $transition-fast;

  &:hover {
    background: $bg-light;
  }

  &--highlight {
    background: rgba($color-accent, 0.1);

    .stat-block__value {
      color: $color-accent;
    }
  }

  &__icon {
    font-size: $font-size-2xl;
  }

  &__value {
    font-size: $font-size-2xl;
    font-weight: 700;
    color: $text-highlight;
  }

  &__label {
    font-size: $font-size-xs;
    color: $text-muted;
  }
}

.quick-actions {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: $spacing-md;
}

.quick-action {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: $spacing-sm;
  padding: $spacing-lg;
  background: $bg-medium;
  border: 1px solid $border-medium;
  border-radius: $radius-md;
  cursor: pointer;
  transition: all $transition-fast;
  font-family: $font-family-ui;

  &:hover {
    border-color: $color-primary;
    background: rgba($color-primary, 0.1);
    transform: translateY(-2px);
  }

  &__icon {
    font-size: $font-size-2xl;
  }

  &__label {
    font-size: $font-size-sm;
    color: $text-secondary;
  }
}

.task-list {
  display: flex;
  flex-direction: column;
  gap: $spacing-sm;
}

.task-item {
  display: flex;
  align-items: center;
  gap: $spacing-md;
  padding: $spacing-md $spacing-lg;
  background: $bg-medium;
  border: 1px solid $border-dark;
  border-radius: $radius-sm;

  .task-name {
    font-weight: 500;
    color: $text-primary;
  }

  .task-executor {
    flex: 1;
    font-size: $font-size-sm;
    color: $text-muted;
  }
}
</style>
